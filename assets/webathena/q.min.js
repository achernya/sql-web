(function(m){"function"===typeof bootstrap?bootstrap("promise",m):"object"===typeof exports?module.exports=m():"function"===typeof define&&define.amd?define(m):"undefined"!==typeof ses?ses.ok()&&(ses.makeQ=m):Q=m()})(function(){function m(a){var b=Function.call;return function(){return b.apply(a,arguments)}}function I(a,b){b.stack&&("object"===typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(J))&&(a.stack=K(a.stack)+"\n"+J+"\n"+K(b.stack))}function K(a){a=a.split("\n");for(var b=[],d=0;d<a.length;++d){var l=
a[d],c;if(c=/at .+ \((.*):(\d+):\d+\)/.exec(l)){var g=c[2];c=c[1]===L&&g>=V&&g<=W}else c=!1;!c&&!(-1!==l.indexOf("(module.js:")||-1!==l.indexOf("(node.js:"))&&b.push(l)}return b.join("\n")}function M(){if(Error.captureStackTrace){var a,b,d=Error.prepareStackTrace;Error.prepareStackTrace=function(d,c){a=c[1].getFileName();b=c[1].getLineNumber()};Error().stack;Error.prepareStackTrace=d;L=a;return b}}function c(a){return s(a)}function k(){function a(a){b&&(l=s(a),v(b,function(a,b){n(function(){l.promiseDispatch.apply(l,
b)})},void 0),d=b=void 0)}var b=[],d=[],l,f=A(k.prototype),g=A(p.prototype);g.promiseDispatch=function(a,c,g){var f=h(arguments);b?(b.push(f),"when"===c&&g[1]&&d.push(g[1])):n(function(){l.promiseDispatch.apply(l,f)})};g.valueOf=function(){if(b)return g;var a=r(l);w(a)&&(l=a);return a};Error.captureStackTrace&&0<c.longStackJumpLimit&&(Error.captureStackTrace(g,k),g.stack=g.stack.substring(g.stack.indexOf("\n")+1));f.promise=g;f.resolve=a;f.fulfill=function(b){a(B(b))};f.reject=function(b){a(q(b))};
f.notify=function(a){b&&v(d,function(b,d){n(function(){d(a)})},void 0)};return f}function p(a,b,d,c,f){void 0===b&&(b=function(a){return q(Error("Promise does not support operation: "+a))});var g=A(p.prototype);g.promiseDispatch=function(d,c,l){var f;try{f=a[c]?a[c].apply(g,l):b.call(g,c,l)}catch(e){f=q(e)}d&&d(f)};d&&(g.valueOf=d);f&&(g.exception=c);return g}function r(a){return w(a)?a.valueOf():a}function w(a){return a&&"function"===typeof a.promiseDispatch}function C(a){return a&&"function"===
typeof a.then}function D(a){return!C(r(a))}function N(a){a=r(a);return w(a)&&"exception"in a}function q(a){var b=p({when:function(b){if(b){var c=X(E,this);-1!==c&&(x.splice(c,1),E.splice(c,1))}return b?b(a):this}},function(){return q(a)},function(){return this},a,!0);!O&&("undefined"!==typeof window&&!window.Touch&&window.console)&&console.log("Should be empty:",x);O=!0;E.push(b);x.push(a);return b}function B(a){return p({when:function(){return a},get:function(b){return a[b]},set:function(b,d){a[b]=
d},"delete":function(b){delete a[b]},post:function(b,d){return null===b||void 0===b?a.apply(void 0,d):a[b].apply(a,d)},apply:function(b,d){return a.apply(b,d)},keys:function(){return Y(a)}},void 0,function(){return a})}function s(a){if(w(a))return a;a=r(a);return C(a)?Z(a):B(a)}function Z(a){var b=k();n(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(d){b.reject(d)}});return b.promise}function e(a,b,d,l){function f(a){try{return"function"===typeof b?b(a):a}catch(d){return q(d)}}function g(a){if("function"===
typeof d){I(a,m);try{return d(a)}catch(b){return q(b)}}return q(a)}var e=k(),h=!1,m=s(a);n(function(){m.promiseDispatch(function(a){h||(h=!0,e.resolve(f(a)))},"when",[function(a){h||(h=!0,e.resolve(g(a)))}])});m.promiseDispatch(void 0,"when",[void 0,function(a){var b,d=!1;try{b="function"===typeof l?l(a):a}catch(f){if(d=!0,c.onerror)c.onerror(f);else throw f;}d||e.notify(b)}]);return e.promise}function P(a,b,d){return e(a,function(a){return z(a).then(function(a){return b.apply(void 0,a)},d)},d)}function y(a,
b,d){var c=k();n(function(){s(a).promiseDispatch(c.resolve,b,d)});return c.promise}function t(a){return function(b){var d=h(arguments,1);return y(b,a,d)}}function R(a,b){var d=h(arguments,2);return F(a,b,d)}function u(a,b){return y(a,"apply",[void 0,b])}function G(a){var b=h(arguments,1);return u(a,b)}function z(a){return e(a,function(a){var d=0,c=k();v(a,function(f,g,h){D(g)?a[h]=r(g):(++d,e(g,function(f){a[h]=f;0===--d&&c.resolve(a)},c.reject))},void 0);0===d&&c.resolve(a);return c.promise})}function S(a,
b){return e(a,void 0,b)}var V=M(),L,T=function(){},n;"undefined"!==typeof process?n=process.nextTick:"function"===typeof setImmediate?n="undefined"!==typeof window?setImmediate.bind(window):setImmediate:function(){function a(){--f;if(++e>=c){e=0;c*=4;for(var a=g&&Math.min(g-1,c);f<a;)++f,h()}for(;g;)--g,b=b.next,a=b.task,b.task=void 0,a();e=0}var b={task:void 0,next:null},d=b,c=2,f=0,g=0,e=0,h;n=function(a){d=d.next={task:a,next:null};f<++g&&f<c&&(++f,h())};if("undefined"!==typeof MessageChannel){var k=
new MessageChannel;k.port1.onmessage=a;h=function(){k.port2.postMessage(0)}}else h=function(){setTimeout(a,0)}}();var h=m(Array.prototype.slice),v=m(Array.prototype.reduce||function(a,b){var d=0,c=this.length;if(1===arguments.length){do{if(d in this){b=this[d++];break}if(++d>=c)throw new TypeError;}while(1)}for(;d<c;d++)d in this&&(b=a(b,this[d],d));return b}),X=m(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),U=m(Array.prototype.map||function(a,
b){var d=this,c=[];v(d,function(f,g,e){c.push(a.call(b,g,e,d))},void 0);return c}),A=Object.create||function(a){function b(){}b.prototype=a;return new b},$=m(Object.prototype.hasOwnProperty),Y=Object.keys||function(a){var b=[],d;for(d in a)$(a,d)&&b.push(d);return b},aa=m(Object.prototype.toString),H;H="undefined"!==typeof ReturnValue?ReturnValue:function(a){this.value=a};c.longStackJumpLimit=1;var J="From previous event:";c.nextTick=n;c.defer=k;k.prototype.makeNodeResolver=function(){var a=this;
return function(b,d){b?a.reject(b):2<arguments.length?a.resolve(h(arguments,1)):a.resolve(d)}};c.promise=function(a){var b=k();G(a,b.resolve,b.reject,b.notify).fail(b.reject);return b.promise};c.makePromise=p;p.prototype.then=function(a,b,d){return e(this,a,b,d)};p.prototype.thenResolve=function(a){return e(this,function(){return a})};p.prototype.thenReject=function(a){return e(this,function(){throw a;})};v("isFulfilled isRejected isPending dispatch when spread get put set del delete post send invoke keys fapply fcall fbind all allResolved timeout delay catch finally fail fin progress done nfcall nfapply nfbind denodeify nbind ncall napply nbind npost nsend ninvoke nodeify".split(" "),
function(a,b){p.prototype[b]=function(){return c[b].apply(c,[this].concat(h(arguments)))}},void 0);p.prototype.toSource=function(){return this.toString()};p.prototype.toString=function(){return"[object Promise]"};c.nearer=r;c.isPromise=w;c.isPromiseAlike=C;c.isPending=function(a){return!D(a)&&!N(a)};c.isFulfilled=D;c.isRejected=N;var E=[],x=[],O;if("undefined"!==typeof process&&process.on)process.on("exit",function(){for(var a=0;a<x.length;a++){var b=x[a];b&&"undefined"!==typeof b.stack?console.warn("Unhandled rejected promise:",
b.stack):console.warn("Unhandled rejected promise (no stack):",b)}});c.reject=q;c.fulfill=B;c.resolve=s;c.master=function(a){return p({isDef:function(){}},function(b,d){return y(a,b,d)},function(){return r(a)})};c.when=e;c.spread=P;c.async=function(a){return function(){function b(a,b){var h;try{h=d[a](b)}catch(k){return"[object StopIteration]"===aa(k)||k instanceof H?k.value:q(k)}return e(h,c,f)}var d=a.apply(this,arguments),c=b.bind(b,"send"),f=b.bind(b,"throw");return c()}};c["return"]=function(a){throw new H(a);
};c.promised=function(a){return function(){return P([this,z(arguments)],function(b,d){return a.apply(b,d)})}};c.dispatch=y;c.dispatcher=t;c.get=t("get");c.set=t("set");c["delete"]=c.del=t("delete");var F=c.post=t("post");c.send=R;c.invoke=R;c.fapply=u;c["try"]=G;c.fcall=G;c.fbind=function(a){var b=h(arguments,1);return function(){var d=b.concat(h(arguments));return y(a,"apply",[this,d])}};c.keys=t("keys");c.all=z;c.allResolved=function(a){return e(a,function(a){a=U(a,s);return e(z(U(a,function(a){return e(a,
T,T)})),function(){return a})})};c["catch"]=c.fail=S;c.progress=function(a,b){return e(a,void 0,void 0,b)};c["finally"]=c.fin=function(a,b){return e(a,function(a){return e(b(),function(){return a})},function(a){return e(b(),function(){return q(a)})})};c.done=function(a,b,d,l){var f=function(b){n(function(){I(b,a);if(c.onerror)c.onerror(b);else throw b;})};b=b||d||l?e(a,b,d,l):a;"object"===typeof process&&(process&&process.domain)&&(f=process.domain.bind(f));S(b,f)};c.timeout=function(a,b){var d=k(),
c=setTimeout(function(){d.reject(Error("Timed out after "+b+" ms"))},b);e(a,function(a){clearTimeout(c);d.resolve(a)},function(a){clearTimeout(c);d.reject(a)},d.notify);return d.promise};c.delay=function(a,b){void 0===b&&(b=a,a=void 0);var d=k();e(a,void 0,void 0,d.notify);setTimeout(function(){d.resolve(a)},b);return d.promise};c.nfapply=function(a,b){var d=h(b),c=k();d.push(c.makeNodeResolver());u(a,d).fail(c.reject);return c.promise};c.nfcall=function(a){var b=h(arguments,1),d=k();b.push(d.makeNodeResolver());
u(a,b).fail(d.reject);return d.promise};c.nfbind=function(a){var b=h(arguments,1);return function(){var d=b.concat(h(arguments)),c=k();d.push(c.makeNodeResolver());u(a,d).fail(c.reject);return c.promise}};c.denodeify=c.nfbind;c.nbind=function(a,b){var c=h(arguments,2);return function(){var e=c.concat(h(arguments)),f=k();e.push(f.makeNodeResolver());u(function(){return a.apply(b,arguments)},e).fail(f.reject);return f.promise}};c.npost=function(a,b,c){c=h(c||[]);var e=k();c.push(e.makeNodeResolver());
F(a,b,c).fail(e.reject);return e.promise};c.nsend=function(a,b){var c=h(arguments,2),e=k();c.push(e.makeNodeResolver());F(a,b,c).fail(e.reject);return e.promise};c.ninvoke=c.nsend;c.nodeify=function(a,b){if(b)a.then(function(a){n(function(){b(null,a)})},function(a){n(function(){b(a)})});else return a};var W=M();return c});
//@ sourceMappingURL=q.min.js.map
